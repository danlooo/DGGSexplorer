{% extends "page.html" %} {% block head %}
<link rel='stylesheet' href='https://unpkg.com/maplibre-gl@5.6.1/dist/maplibre-gl.css' />
<script src='https://unpkg.com/maplibre-gl@5.6.1/dist/maplibre-gl.js'></script>

{% endblock %} {% block body %}

<h4 class="mx-3">Collection {{ id }}</h4>

<nav class="mx-3">
  <div class="nav nav-tabs" id="nav-tab" role="tablist">
    <button class="nav-link active" id="nav-home-tab" data-bs-toggle="tab" data-bs-target="#nav-home" type="button"
      role="tab" aria-controls="nav-home" aria-selected="true">Map</button>
    <button class="nav-link" id="nav-profile-tab" data-bs-toggle="tab" data-bs-target="#nav-profile" type="button"
      role="tab" aria-controls="nav-profile" aria-selected="false">Info</button>

    <button class="nav-link" type="button" role="tab" aria-selected="false">
      <a href="?f=json">
        JSON
      </a>
    </button>
  </div>
</nav>

<div class="tab-content flex-fill" id="nav-tabContent">
  <div class="tab-pane fade show active h-100" id="nav-home" role="tabpanel" aria-labelledby="nav-home-tab">
    <div id="map" class="h-100"></div>
  </div>
  <div class="tab-pane fade mx-3" id="nav-profile" role="tabpanel" aria-labelledby="nav-profile-tab">
    <table class="w-100">
      <tbody>
        <tr>
          <td class="w-50">
            <table class="table table-striped">
              <tbody>
                <tr>
                  <td>DGGSRS</td>
                  <td>{{collection.dggsrs}}</td>
                </tr>
                <tr>
                  <td>Geo BBox</td>
                  <td>{{collection.bbox}}</td>
                </tr>
                <tr>
                  <td>Array size</td>
                  <td>{{size}}</td>
                </tr>
                <tr>
                  <td>Zarr storage</td>
                  <td><code>{{url}}</code></td>
                </tr>
              </tbody>
            </table>
          </td>
          <td class="w-50"><img src="{{id}}/map" /></td>
        </tr>
      </tbody>
    </table>

    <h2>Meta data</h2>

    <table class="table table-striped w-auto">
      <thead>
        <tr>
          <th scope="col">Key</th>
          <th scope="col">Value</th>
        </tr>
      </thead>
      <tbody>
        {% for meta in metadata %}
        <tr>
          <td>{{meta.key}}</td>
          <td>{{meta.val}}</td>
        </tr>
        {% end %}
      </tbody>
    </table>

    <h2>Layers</h2>
    {% for layer in layers %}
    <h3>{{ layer }}</h3>
    <code>/collections/{{id}}/coverage/tiles/WebMercatorQuad/{z}/{x}/{y}?subset=Layer({{layer}})</code>

    {% end %}
  </div>
</div>

<script>
  const map = new maplibregl.Map({
    container: 'map',
    style: {
      version: 8,
      sources: {
        'osm-tiles': {
          type: 'raster',
          tiles: ["https://tile.openstreetmap.org/{z}/{x}/{y}.png"],
          tileSize: 256,
          attribution: 'Â© OpenStreetMap contributors'
        },
        'dggs-tiles': {
          type: 'raster',
          tiles: ["http://127.0.0.1:8080/collections/{{id}}/coverage/tiles/WebMercatorQuad/{z}/{x}/{y}?subset={{map_layer}}"],
          tileSize: 256,
        }
      },
      layers: [
        {
          id: 'osm-tiles',
          type: 'raster',
          source: 'osm-tiles',
          minzoom: 0,
        },
        {
          id: 'dggs-tiles',
          type: 'raster',
          source: 'dggs-tiles',
          minzoom: 0,
        },
      ]
    },
    canvasContextAttributes: { antialias: true }
  });


  map.on('style.load', () => {
    map.setProjection({
      type: 'globe', // Set projection to globe
    });

    map.fitBounds([
      {{ geo_bbox.X[1] }}, {{ geo_bbox.Y[1] }},
    {{ geo_bbox.X[2] }}, {{ geo_bbox.Y[2] }}
      ], {
      linear: true,
      duration: 0,
      padding: 100
    });
    });
</script>
{% endblock %}